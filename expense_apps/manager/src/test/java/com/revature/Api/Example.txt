package com.revature.API;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;

import java.util.Collections;

import org.junit.jupiter.api.Test;

public class Example {

    @Test
    public void testGenerateAllExpensesReport() {
// Arrange
        String csvContent = "id,description,amount\n1,Lunch,20.0";
        when(expenseService.getAllExpenses()).thenReturn(Collections.emptyList());
        when(expenseService.generateCsvReport(any())).thenReturn(csvContent);

// Act & Assert
        given()
                .when()
                .get("/api/reports/expenses/csv")
                .then()
                .statusCode(200)
                .contentType("text/csv")
                .header("Content-Disposition", "attachment;
filename =
        \"all_expenses_report.csv\"")
.body(equalTo(csvContent));
    }

    @Test
    public void testGeneratePendingExpensesReport() {
// Arrange
        String csvContent = "id,description,amount,status\n2,Dinner,50.0,PENDING";
        when(expenseService.getPendingExpenses()).thenReturn(Collections.emptyList());
        when(expenseService.generateCsvReport(any())).thenReturn(csvContent);

// Act & Assert
        given()
                .when()
                .get("/api/reports/expenses/pending/csv")
                .then()
                .statusCode(200)
                .contentType("text/csv")
                .header("Content-Disposition", "attachment;
filename =
        \"pending_expenses_report.csv\"")
.body(equalTo(csvContent));
    }

    @Test
    public void testGenerateEmployeeExpensesReport() {
// Arrange
        int employeeId = 123;
        String csvContent = "id,description,amount,employee\n3,Hotel,200.0,123";
        when(expenseService.getExpensesByEmployee(employeeId)).thenReturn(Collections.emptyList());
        when(expenseService.generateCsvReport(any())).thenReturn(csvContent);

// Act & Assert
        given()
                .when()
                .get("/api/reports/expenses/employee/" + employeeId + "/csv")
                .then()
                .statusCode(200)
                .contentType("text/csv")
                .header("Content-Disposition", "attachment; filename=\"employee_"
                        + employeeId + "_expenses_report.csv\"")
                .body(equalTo(csvContent));
    }

    @Test
    public void testGenerateCategoryExpensesReport() {
// Arrange
        String category = "Travel";
        String csvContent = "id,description,amount,category\n4,Flight,500.0,Travel";
        when(expenseService.getExpensesByCategory(category)).thenReturn(Collections.emptyList());
        when(expenseService.generateCsvReport(any())).thenReturn(csvContent);

// Act & Assert
        given()
                .when()
                .get("/api/reports/expenses/category/" + category + "/csv")
                .then()
                .statusCode(200)
                .contentType("text/csv")
                .header("Content-Disposition", "attachment; filename=\"category_" + category
                        + "_expenses_report.csv\"")
                .body(equalTo(csvContent));
    }

    @Test
    public void testGenerateDateRangeExpensesReport() {
// Arrange
        String startDate = "2023-01-01";
        String endDate = "2023-01-31";
        String csvContent = "id,description,date\n5,Taxi,2023-01-15";
        when(expenseService.getExpensesByDateRange(startDate,
                endDate)).thenReturn(Collections.emptyList());
        when(expenseService.generateCsvReport(any())).thenReturn(csvContent);

// Act & Assert
        given()
                .queryParam("startDate", startDate)
                .queryParam("endDate", endDate)
                .when()
                .get("/api/reports/expenses/daterange/csv")
                .then()
                .statusCode(200)
                .contentType("text/csv")
                .header("Content-Disposition", "attachment; filename=\"expenses_" + startDate
                        + "_to_" + endDate + "_report.csv\"")
                .body(equalTo(csvContent));
    }

    @Test
    public void testGenerateDateRangeExpensesReport_MissingParams() {
// Act & Assert
        given()
                .queryParam("startDate", "2023-01-01")
                // missing endDate
                .when()
                .get("/api/reports/expenses/daterange/csv")
                .then()
                .statusCode(400); // Expecting BadRequest
    }
}

}
